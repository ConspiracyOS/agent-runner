id: CON-SYS-004
description: Agent sessions must not exceed 30 minutes
type: detective
frequency: 60s
scope: system
checks:
  - name: session_duration
    command:
      run: "ps -eo user,etimes,args --no-headers | grep '[c]on run' | awk '{if ($2 > 1800) print $1}' | head -1 | sed 's/^a-//'"
      test: "[ -z \"$RESULT\" ]"
    on_fail:
      action: kill_session
      escalate: sysadmin
      message: "CON-SYS-004 FAILED: agent session exceeds 30 minutes"
